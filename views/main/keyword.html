
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户信息管理</title>
    <!-- ========== Css Files ========== -->
    <link href="../../static/css/root.css" rel="stylesheet">
    <style>
        html{
            overflow-y:auto;
            overflow-x: hidden;
        }
        .content{
            padding-top:209px;
        }
        /*下拉框宽度设置*/
        .bootstrap-select:not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
            width: 140px;
            height: 34px;
        }
        .red{
            color: red;
        }
        .col-center-block {
            float: none;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .modal-dialog{
            /*margin-left:35%;*/
        }
        #tip{
            color: red;
            font-size: 12px;
        }

        .active{
            color: #6195ff;
            cursor: pointer;
        }

        .transparent_class {
            filter:alpha(opacity=85);
            -moz-opacity:0.85;
            -khtml-opacity: 0.85;
            opacity: 0.85;
        }
        .table.dataTable thead th, table.dataTable td{
            text-align: center;
        }
        textarea {
            padding: 10px 10px;
            min-height: 120px;
            resize: vertical;
        }
    </style>
</head>
<body style="padding-bottom: 8%">
<div id="loading" class="loading-wrap">
    <div class="loader" >
        <div class="la-ball-clip-rotate-multiple la-3x">
            <div></div>
            <div></div>
        </div>
        <div class="loaderTxt">数据交互中...</div>
    </div>
</div>

<div style="position: fixed;top:0px;width: 100%;z-index: 99">

    <div class="transparent_class" id="blank" style="width: 100%;height: 60px;background-color:#6195ff"></div>
    <!-- Start Page Header -->
    <div class="page-header" style="padding-left: 15px;">
        <h2 class="title">关键词管理</h2>
        <ol class="breadcrumb">
            <li><span id="tabHref01" href="javascript:void(0)">数据列表</span></li>
            <li><span id="tabHref02" class="active" href="javascript:void(0)">新增数据</span></li>
        </ol>
    </div>

</div>

<!-- START CONTENT -->
<div class="content">

    <!-- START CONTAINER -->
    <div class="container-padding" >

        <!-- Start Row -->
        <div class="row">

            <!-- Start Panel -->
            <div id="panel" class="col-sm-12">
                <div class="panel panel-default">
                    <div id="tab1" class="panel-body table-responsive">
                        <table id="myTable" class="table display">
                            <thead>
                            <tr>
                                <th>账号</th>
                                <th>密码</th>
                                <th>姓名</th>
                                <th>账号类型</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div id="tab2" style="display: none">

                        <div class="panel-body">
                            <form class="form-horizontal" autocomplete="off">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label form-label"></label>
                                    <div class="col-sm-10">
                                        <p class="form-control-static"></p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="account" class="col-sm-2 control-label form-label"><span class="red">*</span>关键词</label>
                                    <div class="col-sm-10">
                                        {{/*onKeyUp="value=value.replace(/[^/a-zA-Z0-9]/g,'')"*/}}
                                        <input type="text" class="form-control" maxlength="20" style="ime-mode:disabled" id="keyword" placeholder="请输入关键词">
                                        <span class="help-block"></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label form-label">所属分组</label>
                                    <div class="col-sm-6">
                                        <select id="type" class="selectpicker" >
                                            <option selected value="1">默认分组</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label form-label"><span class="red">*</span>外链地址</label>
                                    <div class="col-sm-6">
                                        <select id="url" class="selectpicker" >
                                            <option selected value="1">url01</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="name" class="col-sm-2 control-label form-label">描述信息</label>
                                    <div class="col-sm-10">
                                        <textarea id="description" class="form-control" placeholder=""></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="name" class="col-sm-2 control-label form-label">备注信息</label>
                                    <div class="col-sm-10">
                                        <textarea id="remark" class="form-control" placeholder=""></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-offset-6">
                                        <a href="javascript:add()" class="btn btn-default">提交</a>&nbsp;&nbsp;
                                        <a id="reset" href="javascript:reset()" class="btn btn-danger">重置</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Panel -->

        </div>
        <!-- End Row -->

    </div>
    <!-- END CONTAINER -->

    <!-- 模态框-detail（Modal） -->
    <div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">×
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        查看详情
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="col-sm-offset-1">
                        <p class="form-control-static" >关键词：<span id="detail_keyword"></span></p>
                    </div>
                    <div class="col-sm-offset-1">
                        <p class="form-control-static" >外链：<span id="detail_url"></span></p>
                    </div>
                    <div class="col-sm-offset-1">
                        <p class="form-control-static" >描述信息：<span id="detail_description"></span></p>
                    </div>
                    <div class="col-sm-offset-1">
                        <p class="form-control-static" >备注信息：<span id="detail_remark"></span></p>
                    </div>
                    <div class="col-sm-offset-1">
                        <p class="form-control-static" >创建时间：<span id="detail_created"></span></p>
                    </div>
                    <div class="col-sm-offset-1">
                        <p class="form-control-static" >最近一次更新：<span id="detail_updated"></span></p>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default"
                            data-dismiss="modal">关闭
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- 模态框-edit（Modal） -->
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">×
                    </button>
                    <h4 class="modal-title" id="editModalLabel">
                        编辑信息&nbsp;&nbsp;<span id="tip"></span>
                    </h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" autocomplete="off">
                        <div class="form-group">
                            <label class="col-sm-2 control-label form-label"></label>
                            <div class="col-sm-10">
                                <p class="form-control-static"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="account" class="col-sm-2 control-label form-label"><span class="red">*</span>关键词</label>
                            <div class="col-sm-10">
                            {{/*onKeyUp="value=value.replace(/[^/a-zA-Z0-9]/g,'')"*/}}
                                <input type="hidden" id="id_edit">
                                <input type="text" class="form-control" maxlength="20" style="ime-mode:disabled" id="keyword_edit" placeholder="请输入关键词">
                                <span class="help-block"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label form-label">所属分组</label>
                            <div class="col-sm-6">
                                <select id="type_edit" class="selectpicker" >
                                    <option selected value="1">默认分组</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label form-label"><span class="red">*</span>外链地址</label>
                            <div class="col-sm-6">
                                <select id="url_edit" class="selectpicker" >
                                    <option selected value="1">url01</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="name" class="col-sm-2 control-label form-label">描述信息</label>
                            <div class="col-sm-10">
                                <textarea id="description_edit" class="form-control" placeholder=""></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="name" class="col-sm-2 control-label form-label">备注信息</label>
                            <div class="col-sm-10">
                                <textarea id="remark_edit" class="form-control" placeholder=""></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="edit()" class="btn btn-default">
                        提交更新
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


</div>
<!-- End Content -->


<script src="https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap-select/2.0.0-beta1/js/bootstrap-select.min.js"></script>
<script src="../../static/js/util.js"></script>

<!-- ================================================
Data Tables
================================================ -->
<script src="../../static/plugins/datatables/datatables.min.js"></script>

<script>
    var myTable;
    $(document).ready(function() {

        //调用父页面弹窗通知
        //window.parent.swalInfo('TEST',666,'error')

        //tab导航栏切换
        $('#tabHref01').on("click",function () {
            var isActive = $(this).attr("class");
            if(!isActive){
                return
            }else{
                $('#tabHref02').addClass("active");
                $(this).removeClass("active");
                $('#tab2').fadeOut(100);
                $("#tab1").fadeIn(100);
                refresh();
            }
        });
        $('#tabHref02').on("click",function () {
            var isActive = $(this).attr("class");
            if(!isActive){
                return
            }else{
                $('#tabHref01').addClass("active");
                $(this).removeClass("active");
                $('#tab1').fadeOut(100);
                $("#tab2").fadeIn(100);
            }
        });

        //datatable setting
        myTable =$('#myTable').DataTable({
            /*scrollY:        '100vh',*/
            autoWidth: true,
            scrollCollapse: true,
            "processing": true,
            serverSide: true,
            //bSort:false,//排序
            "aoColumnDefs": [ { "bSortable": false, "aTargets": [ 0,1,2,3,5 ] }],//指定哪些列不排序
            "order": [[ 4, "desc" ]],//默认排序
            ajax: {
                url: '/main/keyword/list',
                type: 'POST'
            },
            columns: [
                { data: 'keyword'},
                { data: 'url' },
                { data: 'description',"render":function (data) {
                        if(!data){
                            data = "暂未填写";
                        }
                        return data;
                    } },
                { data: 'remark',"render":function (data) {
                        return data;
                    } },
                { data: 'created',"render":function (data,type,row,meta) {
                        var unixTimestamp = new Date(data) ;
                        var commonTime = unixTimestamp.toLocaleString('chinese',{hour12:false});
                        return commonTime;
                    }},
                { data: null,"render":function () {
                        var html = "<a href='javascript:void(0);'  class='delete btn btn-default btn-xs'>查看</a>&nbsp;"
                        html += "<a href='javascript:void(0);' class='up btn btn-info btn-xs'></i>编辑</a>&nbsp;"
                        html += "<a href='javascript:void(0);' class='down btn btn-danger btn-xs'>删除</a>"
                        return html;
                    } }
            ],
            language: {
                url: '../plugins/datatables/zh_CN.json'
            },
            "createdRow": function ( row, data, index ) {//回调函数用于格式化返回数据
                /*if(!data.name){
                    $('td', row).eq(2).html("暂未填写");
                }*/
            }
        });

        $('.dataTables_wrapper .dataTables_filter input').css("background","blue");

        var rowData;
        $('#myTable').on("click",".btn-default",function(e){//查看
            rowData = myTable.row($(this).closest('tr')).data();
            console.log(rowData);
            $('#detail_keyword').html(rowData.account);
            $('#detail_url').html(rowData.password);
            var type = rowData.type;
            $('#detail_type').html(type);
            var description = rowData.description;
            if(!description){
                description = "暂未填写";
            }
            $('#detail_description').html(description);
            var remark = rowData.remark;
            if(!remark){
                remark = "暂未填写";
            }
            $('#detail_remark').html(remark);
            var created = rowData.created;
            var unixTimestamp = new Date(created) ;
            var commonTime = unixTimestamp.toLocaleString('chinese',{hour12:false});
            $('#detail_created').html(commonTime);

            var updated = rowData.updated;
            if(updated){
                var unixTimestamp = new Date(updated) ;
                updated = unixTimestamp.toLocaleString('chinese',{hour12:false});
            }else{
                updated = "暂无更新";
            }

            $('#detail_updated').html(updated);
            $('#detailModal').modal("show");
        });
        $('#myTable').on("click",".btn-info",function(e){//编辑
            rowData = myTable.row($(this).closest('tr')).data();
            console.log(rowData);
            $('#id_edit').val(rowData.id);
            $('#keyword_edit').val(rowData.keyword);
            var type = rowData.type;
            $("#type_edit").selectpicker('val',type);//默认选中 value=“1” 的option
            $("#type_edit").selectpicker('refresh');
            var url = rowData.url;
            $("#url_edit").selectpicker('val',url);//默认选中 value=“1” 的option
            $("#url_edit").selectpicker('refresh');
            $('#description_edit').val(rowData.description);
            $('#remark_edit').val(rowData.remark);
            $('#tip').html("");
            $('#editModal').modal("show");
        });
        $('#myTable').on("click",".btn-danger",function(e){//删除
            rowData = myTable.row($(this).closest('tr')).data();
            console.log(rowData);
            var id = rowData.id;

            swal({
                title: "确定删除吗?",
                text: '删除将无法恢复该信息!',
                type: 'info',
                showCancelButton: true,
                confirmButtonColor: '#6195FF',
                cancelButtonColor: '#ff1200',
                confirmButtonText: '确定',
                cancelButtonText:'取消'
            },function(){
                del(id);
            });

        });

    } );

    function add(){
        var keyword = $('#keyword').val().trim();
        var type = $('#type').val();
        var url = $('#url').val().trim();
        var description = $('#description').val().trim();
        var remark = $('#remark').val().trim();
        if (!keyword){
            swal("关键字不能为空!",' ',"warning");
            return;
        }
        $.ajax({
            url : "/main/keyword/add",
            type : "POST",
            dataType : "json",
            cache : false,
            data : {
                keyword:keyword,
                type:type,
                url:url,
                description:description,
                remark:remark
            },
            beforeSend:function(){
                $('#loading').fadeIn(200);
            },
            success : function(r) {
                var type = "error";
                if (r.code == 1) {
                    type = "success";
                    reset();
                }
                swal(r.msg,' ',type);
            },
            complete:function () {
                $('#loading').fadeOut(200);
            }
        });
    }

    function edit(){
        var id = $('#id_edit').val();
        var keyword = $('#keyword_edit').val().trim();
        var type = $('#type_eidt').val();
        var url = $('#url_edit').val().trim();
        var description = $('#description_edit').val().trim();
        var remark = $('#remark_edit').val().trim();
        if (!keyword){
            swal("关键字不能为空!",' ',"warning");
            return;
        }
        $.ajax({
            url : "/main/keyword/update",
            type : "POST",
            dataType : "json",
            cache : false,
            data : {
                id:id,
                keyword:keyword,
                type:type,
                url:url,
                description:description,
                remark:remark
            },
            beforeSend:function(){
                $('#loading').fadeIn(200);
            },
            success : function(r) {
                var type = "error";
                if (r.code == 1) {
                    type = "success";
                    reset();
                }
                swal(r.msg,' ',type);
            },
            complete:function () {
                $('#loading').fadeOut(200);
            }
        });
    }

    function del(id){

        $.ajax({
            url : "/main/keyword/delete",
            type : "POST",
            dataType : "json",
            cache : false,
            data : {
                id:id
            },
            beforeSend:function(){
                $('#loading').fadeIn(200);
            },
            success : function(r) {
                if (r.code == 1) {
                    swal(r.msg,' ', "success");
                    refresh();
                }else{
                    swal(r.msg,' ', "error");
                }
            },
            complete:function () {
                $('#loading').fadeOut(200);
            }
        })
    }

    function reset() {
        $(":input").each(function () {
            $(this).val("");
        });
        $(".selectpicker").selectpicker('val',1);//下拉框选中 value=“1” 的option
        $(".selectpicker").selectpicker('refresh');
        $("textarea").each(function () {
           $(this).val("");
        });
    }

    function refresh() {
        myTable.ajax.reload();
    }

    function swal(title,msg,type) {
        window.parent.swalInfo(title,msg,type);
    }

</script>


</body>
</html>